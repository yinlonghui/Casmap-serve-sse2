#include "seq.h"
#include <math.h>

const char nt4_table[32]={ 
	0,4,1,4,4,4,2,4,
	4,4,4,4,4,4,4,4,
	4,4,4,3,4,4,4,4,
	4,4,4,4,4,4,4,4,
};

const char comp_table[32]={ 
	'T','N','G','N','N','N','C','N',
	'N','N','N','N','N','N','N','N',
	'N','N','N','A','N','N','N','N',
	'N','N','N','N','N','N','N','N',
};

const char nt4_rev_table[16]={
	'A','C','G','T','N','N','N','N',
	'N','N','N','N','N','N','N','N',
};

const char nst_nt4_table[256] = {
	0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x5, 0x4, 0x4,
	0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x0, 0x4, 0x1,  0x4, 0x4, 0x4, 0x2,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x4, 0x4, 0x4,  0x3, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x0, 0x4, 0x1,  0x4, 0x4, 0x4, 0x2,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x4, 0x4, 0x4,  0x3, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
	0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,  0x4, 0x4, 0x4, 0x4,
};

const char nst_nt4_comp[256] = {
	'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'T', 'N', 'G',  'N', 'N', 'N', 'C',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'N', 'N', 'N',  'A', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'T', 'N', 'G',  'N', 'N', 'N', 'C',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'N', 'N', 'N',  'A', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
	'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',  'N', 'N', 'N', 'N',
};

unsigned char diff_table[1024];

static int max_diff_l(int l, double err, double thres)
{
	double elambda = exp(-l * err);
	double sum, y = 1.0;
	int k, x = 1;
	for (k = 1, sum = elambda; k < 1000; ++k) {
		y *= l * err;
		x *= k;
		sum += elambda * y / x;
		if (1.0 - sum < thres) return k;
	}
	return 2;
}


void init_diff_table(double thres)
{
	int i;
	if(thres>=1){
		for(i=0;i<1024;++i)
			diff_table[i]=(int)thres;
	}else if(thres>0){
		for(i=0;i<1024;++i)
			diff_table[i]=max_diff_l(i,SEQ_AVG_ERR,thres);
	}else{
		for(i=0;i<1024;++i)
			diff_table[i]=0;
	}
}

